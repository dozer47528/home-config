#!/bin/bash

export PATH="$HOME/.bin:$PATH"

# Env
if [[ "$PROJECT_HOME" == "" ]] then
    echo "Missing Environment Variable `PROJECT_HOME`"
fi

# Trip
if [[ -d /opt/settings ]] then
    TRIP_ENVS=(`ls /opt/settings | grep -E '\w+\.\w+\.\w+' | awk -F. '{print $1}'`)
    for TRIP_ENV in "${TRIP_ENVS[@]}"
    do
        eval "alias env-${TRIP_ENV}=\"ln -s -f /opt/settings/${TRIP_ENV}.server.properties /opt/settings/server.properties\""
    done
fi

j(){
    echo -n Token: 
    read -s token
    sshpass yy_gong@jumpserver.ops.ctripcorp.com "`bw get password http://home.ctripcorp.com` $token"
}

jj(){
    echo -n Token: 
    read -s token
    sshpass yy_gong@ssh.fws.jumpserver.sys.ctripcorp.com "`bw get password http://home.ctripcorp.com` $token"
}

# Java
mvn-version(){
    mvn versions:set -DgenerateBackupPoms=false -DnewVersion=$1
}


# Kubernetes
export UNPROTECTED_CONTEXT=default:rancher-desktop:docker-desktop:minikube:orbstack
export PATH="$HOME/.krew/bin:$PATH"
alias kk=". kube-cluster"
alias kc="kubectl config use-context"
alias kn="kube-namespace"
alias kx="kubectl exec"
alias kg="kubectl get"
alias ke="kubectl edit"
alias kd="kubectl delete"

# App
if [[ $('uname') == 'Darwin' ]]; then
    if  [ -d '/Applications/Visual Studio Code.app' ]; then
        alias vs="open -a '/Applications/Visual Studio Code.app'"
    fi
    if  [ -d '/Applications/Zed.app' ]; then
        alias zed="open -a '/Applications/Zed.app'"
    fi
    if  [ -d '/Applications/IntelliJ IDEA.app' ]; then
        alias idea="open -a '/Applications/IntelliJ IDEA.app'"
    fi
    if  [ -d '/Applications/WebStorm.app' ]; then
        alias webstorm="open -a '/Applications/WebStorm.app'"
    fi
    if  [ -d '/Applications/GoLand.app' ]; then
        alias goland="open -a '/Applications/GoLand.app'"
    fi
fi

# Misc
alias bb="brew update && brew outdated && brew upgrade --greedy && brew cleanup --prune=all"
alias quarantine="xattr -rd com.apple.quarantine"
alias mysql="mysql --default-character-set utf8mb4"
alias x86="arch -x86_64"
alias lo0alias="sudo ifconfig lo0 alias 192.168.88.88"

if command -v bat &> /dev/null
then
    alias cat="bat --paging=never"
fi

if command -v vim &> /dev/null
then
    alias vi=vim
fi

# Env
_set_env(){
    _current_dir=$(pwd)
    while [ "$_current_dir" != "/" ]; do
        source "$_current_dir/.env" 2> /dev/null && break
        _current_dir=$(dirname "$_current_dir")
    done
}
_set_env
add-zsh-hook chpwd _set_env
